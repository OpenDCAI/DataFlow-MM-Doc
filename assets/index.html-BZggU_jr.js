import{_ as i,c as a,b as t,o as e}from"./app-Ct5swOin.js";const n={};function l(h,s){return e(),a("div",null,s[0]||(s[0]=[t(`<h2 id="ğŸ“˜-æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#ğŸ“˜-æ¦‚è¿°"><span>ğŸ“˜ æ¦‚è¿°</span></a></h2><p><code>ImageCatFilter</code> åŸºäº <strong>Caption-as-Teacher</strong> æ€æƒ³ï¼Œç»“åˆ <strong>BART-large-MNLI è‡ªç„¶è¯­è¨€æ¨ç†æ¨¡å‹</strong> ä¸å¯é€‰çš„ <strong>Tesseract OCR</strong>ï¼Œ<br> å¯¹å›¾æ–‡æ ·æœ¬è¿›è¡Œã€Œè¯­ä¹‰å¤æ‚åº¦ + åŠ¨ä½œæ€§ + OCR æŠ„å†™ã€ä¸‰é‡è¿‡æ»¤ï¼Œä»…ä¿ç•™è¯­ä¹‰ä¿¡æ¯æ›´ä¸°å¯Œã€çœŸæ­£æè¿°å›¾åƒå†…å®¹çš„ captionã€‚</p><h2 id="init-å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#init-å‡½æ•°"><span><code>__init__</code>å‡½æ•°</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> __init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    model_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> str</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">facebook/bart-large-mnli</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    complexity_thresh</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> float</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0.4</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    min_caps</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> int</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    action_thresh</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> float</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0.4</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    ocr_overlap_threshold</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> float</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0.2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    ocr_nli_thresh</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> float</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0.6</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    device</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> str</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> None</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> None</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">):</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="initå‚æ•°è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#initå‚æ•°è¯´æ˜"><span><code>init</code>å‚æ•°è¯´æ˜</span></a></h2><table><thead><tr><th style="text-align:left;">å‚æ•°å</th><th style="text-align:left;">ç±»å‹</th><th style="text-align:left;">é»˜è®¤å€¼</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;"><code>model_name</code></td><td style="text-align:left;"><code>str</code></td><td style="text-align:left;"><code>&quot;facebook/bart-large-mnli&quot;</code></td><td style="text-align:left;">ç”¨äº NLI åˆ¤æ–­çš„é¢„è®­ç»ƒæ¨¡å‹åç§°æˆ–æœ¬åœ°è·¯å¾„ï¼›é€šè¿‡ <code>AutoTokenizer</code> ä¸ <code>AutoModelForSequenceClassification</code> åŠ è½½ã€‚</td></tr><tr><td style="text-align:left;"><code>complexity_thresh</code></td><td style="text-align:left;"><code>float</code></td><td style="text-align:left;"><code>0.4</code></td><td style="text-align:left;">caption å¯¹å„ç±»ã€Œèƒ½åŠ›å‡è®¾å¥ã€çš„ <strong>è•´å«æ¦‚ç‡é˜ˆå€¼</strong>ï¼›é«˜äºè¯¥å€¼è§†ä¸ºè¯¥èƒ½åŠ›è¢« caption è¦†ç›–ï¼Œç”¨äºè¡¡é‡è¯­ä¹‰å¤æ‚åº¦ã€‚</td></tr><tr><td style="text-align:left;"><code>min_caps</code></td><td style="text-align:left;"><code>int</code></td><td style="text-align:left;"><code>2</code></td><td style="text-align:left;">è‡³å°‘éœ€è¦è¢«æ”¯æŒçš„èƒ½åŠ›å‡è®¾æ¡æ•°ï¼›å³ caption è‡³å°‘è¦è•´å«å¤šå°‘ç§èƒ½åŠ›ï¼ˆåŠ¨ä½œã€äº¤äº’ã€åœºæ™¯ç»†èŠ‚ç­‰ï¼‰æ‰ç®—â€œå¤æ‚åº¦è¾¾æ ‡â€ã€‚</td></tr><tr><td style="text-align:left;"><code>action_thresh</code></td><td style="text-align:left;"><code>float</code></td><td style="text-align:left;"><code>0.4</code></td><td style="text-align:left;">caption å¯¹ <code>ACTION_HYPOTHESIS</code>ï¼ˆæè¿°åœºæ™¯ä¸­æ­£åœ¨å‘ç”Ÿçš„åŠ¨ä½œï¼‰çš„è•´å«æ¦‚ç‡é˜ˆå€¼ï¼›ä½äºè¯¥å€¼è®¤ä¸ºåŠ¨ä½œæ€§ä¸è¶³è€Œè¢«è¿‡æ»¤ã€‚</td></tr><tr><td style="text-align:left;"><code>ocr_overlap_threshold</code></td><td style="text-align:left;"><code>float</code></td><td style="text-align:left;"><code>0.2</code></td><td style="text-align:left;">OCR æ–‡æœ¬ä¸ caption tokens çš„ Jaccard é‡å åº¦é˜ˆå€¼ï¼›ä»…å½“é‡å åº¦é«˜äºè¯¥å€¼æ—¶æ‰è¿›ä¸€æ­¥ç”¨ NLI åˆ¤æ–­æ˜¯å¦ä¸º OCR æŠ„å†™ã€‚</td></tr><tr><td style="text-align:left;"><code>ocr_nli_thresh</code></td><td style="text-align:left;"><code>float</code></td><td style="text-align:left;"><code>0.6</code></td><td style="text-align:left;">caption å¯¹ <code>OCR_ONLY_HYPOTHESIS</code>ï¼ˆä¸»è¦æŠ„å†™å›¾åƒæ–‡å­—ï¼‰çš„è•´å«æ¦‚ç‡é˜ˆå€¼ï¼›é‡å åº¦é«˜ä¸”è¯¥æ¦‚ç‡è¶…è¿‡æ­¤é˜ˆå€¼æ—¶ï¼Œåˆ¤å®šä¸º OCR æŠ„å†™å¹¶è¿‡æ»¤ã€‚</td></tr><tr><td style="text-align:left;"><code>device</code></td><td style="text-align:left;"><code>str | None</code></td><td style="text-align:left;"><code>None</code></td><td style="text-align:left;"></td></tr></tbody></table><h2 id="runå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#runå‡½æ•°"><span><code>run</code>å‡½æ•°</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DataFlowStorage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    input_image_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> str</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">image</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    input_caption_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> str</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">caption</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">):</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">    ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œç®—å­ä¸»é€»è¾‘ï¼š</p><ol><li><p><strong>è¯»å–æ•°æ®</strong><br> ä» <code>storage</code> ä¸­è¯»å–å½“å‰ DataFrameï¼Œå¹¶æŒ‰è¡Œéå†ï¼Œæ¯ä¸€è¡Œè§†ä¸ºä¸€ä¸ªå›¾æ–‡æ ·æœ¬ï¼š</p><ul><li><code>input_image_key</code> åˆ—ç»™å‡ºå›¾åƒè·¯å¾„ï¼ˆé»˜è®¤ <code>&quot;image&quot;</code>ï¼‰ï¼›</li><li><code>input_caption_key</code> åˆ—ç»™å‡ºè‹±æ–‡ captionï¼ˆé»˜è®¤ <code>&quot;caption&quot;</code>ï¼‰ã€‚</li></ul></li><li><p><strong>å¤æ‚åº¦æ£€æµ‹ï¼ˆComplexity checkï¼‰</strong></p><ul><li>å¯¹å½“å‰ captionï¼Œä¾æ¬¡ä¸ <code>CAPS_HYPOTHESES</code> ä¸­çš„æ¯æ¡ã€Œèƒ½åŠ›å‡è®¾å¥ã€ç»„æˆ NLI å‰æ-å‡è®¾å¯¹ï¼š<br><code>premise = caption</code>ï¼Œ<code>hypothesis = æŸæ¡èƒ½åŠ›å¥</code>ã€‚</li><li>ç”¨ <code>BART-large-mnli</code> è®¡ç®—æ¯æ¡å‡è®¾çš„ <strong>entailment æ¦‚ç‡</strong> <code>p_entail</code>ï¼›</li><li>å½“ <code>p_entail &gt;= complexity_thresh</code> æ—¶ï¼Œè®¤ä¸ºè¯¥èƒ½åŠ›è¢« caption è¦†ç›–ï¼Œå¹¶è®¡å…¥èƒ½åŠ›è®¡æ•°ï¼›</li><li>æœ€ç»ˆèƒ½åŠ›è®¡æ•° <code>cap_num &gt;= min_caps</code> æ—¶ï¼Œè®¤ä¸º caption å…·æœ‰è¶³å¤Ÿçš„è¯­ä¹‰å¤æ‚åº¦ï¼Œå¦åˆ™è¯¥æ ·æœ¬è¢«è¿‡æ»¤ã€‚</li></ul></li><li><p><strong>åŠ¨ä½œæ€§æ£€æµ‹ï¼ˆAction checkï¼‰</strong></p><ul><li>ä½¿ç”¨å•ä¸€å‡è®¾ <code>ACTION_HYPOTHESIS</code>ï¼š <blockquote><p>&quot;The caption clearly describes an action happening in the scene.&quot;</p></blockquote></li><li>è®¡ç®— caption å¯¹è¯¥å‡è®¾çš„ entailment æ¦‚ç‡ <code>p_action</code>ï¼›</li><li>å½“ <code>p_action &lt; action_thresh</code> æ—¶ï¼Œè®¤ä¸º caption å¹¶æœªæ¸…æ™°æè¿°åŠ¨ä½œï¼Œæ ·æœ¬è¢«è¿‡æ»¤ã€‚</li></ul></li><li><p><strong>OCR æŠ„å†™æ£€æµ‹ï¼ˆOCR-only checkï¼Œå¯é€‰ï¼‰</strong></p><ul><li>è‹¥æœ¬æœºæœªå®‰è£… Tesseract æˆ–åˆå§‹åŒ–æ—¶æ£€æµ‹å¤±è´¥ï¼Œåˆ™ <strong>è·³è¿‡</strong> æœ¬æ­¥éª¤ï¼Œé»˜è®¤é€šè¿‡ OCR æ£€æŸ¥ï¼›</li><li>å¦åˆ™ï¼š <ol><li>ä½¿ç”¨ <code>pytesseract.image_to_string</code> å¯¹å›¾åƒåš OCRï¼Œå¾—åˆ° <code>ocr_text</code>ï¼›</li><li>å¯¹ <code>ocr_text</code> ä¸ <code>caption</code> åˆ†åˆ«æå–è‹±æ–‡ token é›†åˆ <code>ocr_tokens</code> ä¸ <code>cap_tokens</code>ï¼›</li><li>è®¡ç®— Jaccard é‡å åº¦ï¼š<br> [ J = \\frac{|ocr_tokens \\cap cap_tokens|}{|ocr_tokens \\cup cap_tokens|} ]</li><li>è‹¥ <code>J &lt; ocr_overlap_threshold</code>ï¼Œè®¤ä¸º caption ä¸ä¸»è¦æŠ„å†™æ–‡å­—ï¼Œé€šè¿‡ OCR æ£€æŸ¥ï¼›</li><li>è‹¥ <code>J &gt;= ocr_overlap_threshold</code>ï¼Œè¿›ä¸€æ­¥æ„é€  <code>OCR_ONLY_HYPOTHESIS</code>ï¼š <blockquote><p>&quot;The caption mainly transcribes the visible text in the image instead of describing the visual scene.&quot;<br> å¹¶è®¡ç®—å…¶ entailment æ¦‚ç‡ <code>p_ocr_only</code>ï¼š</p></blockquote><ul><li>è‹¥ <code>p_ocr_only &gt;= ocr_nli_thresh</code>ï¼Œåˆ™è®¤ä¸º caption ä¸»è¦æ˜¯ OCR æŠ„å†™ï¼Œæ ·æœ¬è¢«è¿‡æ»¤ï¼›</li><li>å¦åˆ™ä»è§†ä¸ºé€šè¿‡ OCR æ£€æŸ¥ã€‚</li></ul></li></ol></li></ul></li><li><p><strong>ç»¼åˆåˆ¤å®š</strong><br> å¯¹æ¯ä¸€è¡Œæ ·æœ¬ï¼Œåªæœ‰å½“ <strong>å¤æ‚åº¦æ£€æµ‹é€šè¿‡ + åŠ¨ä½œæ£€æµ‹é€šè¿‡ + OCR æ£€æµ‹é€šè¿‡</strong> ä¸‰è€…åŒæ—¶æ»¡è¶³æ—¶ï¼Œ<br> æ‰å°†è¯¥è¡Œæ ‡è®°ä¸ºä¿ç•™ï¼›å¦åˆ™æ ‡è®°ä¸ºè¿‡æ»¤ã€‚</p></li></ol><p>å‚æ•°</p><table><thead><tr><th style="text-align:left;">å‚æ•°å</th><th style="text-align:left;">ç±»å‹</th><th style="text-align:left;">é»˜è®¤å€¼</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;"><code>storage</code></td><td style="text-align:left;"><code>DataFlowStorage</code></td><td style="text-align:left;">æ— </td><td style="text-align:left;">Dataflow çš„è¯»å†™å­˜å‚¨å¯¹è±¡ã€‚</td></tr><tr><td style="text-align:left;"><code>input_image_key</code></td><td style="text-align:left;"><code>str</code></td><td style="text-align:left;"><code>&quot;image&quot;</code></td><td style="text-align:left;">å›¾åƒè·¯å¾„æ‰€åœ¨åˆ—åã€‚</td></tr><tr><td style="text-align:left;"><code>input_caption_key</code></td><td style="text-align:left;"><code>str</code></td><td style="text-align:left;"><code>&quot;caption&quot;</code></td><td style="text-align:left;">è‹±æ–‡å›¾åƒæè¿°æ‰€åœ¨åˆ—åã€‚</td></tr></tbody></table><h2 id="ğŸ§ -ç¤ºä¾‹ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#ğŸ§ -ç¤ºä¾‹ç”¨æ³•"><span>ğŸ§  ç¤ºä¾‹ç”¨æ³•</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">utils</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> FileStorage</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">operators</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">core_vision </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ImageCatFilter</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 1) å‡†å¤‡ FileStorageï¼ˆè‡³å°‘åŒ…å« image ä¸ caption ä¸¤åˆ—ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> FileStorage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    first_entry_file_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">./dataflow/example/test_image_filter/test_image_filter.jsonl</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    cache_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">./cache_local</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    file_name_prefix</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">cat_filter</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    cache_type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">jsonl</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 2) åˆå§‹åŒ– Cat è¿‡æ»¤ç®—å­ï¼ˆå¯è°ƒèŠ‚å¤æ‚åº¦é˜ˆå€¼ä¸ OCR ç›¸å…³è¶…å‚ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cat_filter </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ImageCatFilter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    model_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">facebook/bart-large-mnli</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    complexity_thresh</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0.4</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    min_caps</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    action_thresh</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0.4</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    ocr_overlap_threshold</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0.2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    ocr_nli_thresh</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0.6</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    device</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">None</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # è‡ªåŠ¨é€‰æ‹© cuda/cpu</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 3) æ‰§è¡Œè¿‡æ»¤ï¼šä»…ä¿ç•™è¯­ä¹‰å¤æ‚ã€å…·æœ‰åŠ¨ä½œä¸”éçº¯ OCR æŠ„å†™çš„æ ·æœ¬</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cols </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> cat_filter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_image_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">image</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_caption_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">caption</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cols</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # [&quot;image&quot;, &quot;caption&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ğŸ§¾-é»˜è®¤è¾“å‡ºæ ¼å¼-output-format" tabindex="-1"><a class="header-anchor" href="#ğŸ§¾-é»˜è®¤è¾“å‡ºæ ¼å¼-output-format"><span>ğŸ§¾ é»˜è®¤è¾“å‡ºæ ¼å¼ï¼ˆOutput Formatï¼‰</span></a></h3><table><thead><tr><th style="text-align:left;">å­—æ®µå</th><th style="text-align:left;">ç±»å‹</th><th style="text-align:left;">é»˜è®¤å€¼</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;"><code>image</code>ï¼ˆæˆ– <code>input_image_key</code> æŒ‡å®šåˆ—ï¼‰</td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;">æ— </td><td style="text-align:left;">è¾“å…¥å›¾åƒè·¯å¾„ã€‚</td></tr><tr><td style="text-align:left;"><code>caption</code>ï¼ˆæˆ– <code>input_caption_key</code> æŒ‡å®šåˆ—ï¼‰</td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;">æ— </td><td style="text-align:left;">è¾“å…¥è‹±æ–‡å›¾åƒæè¿°ã€‚</td></tr></tbody></table><p>ç¤ºä¾‹è¾“å…¥ï¼š</p><div class="language-jsonl line-numbers-mode" data-highlighter="shiki" data-ext="jsonl" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-jsonl"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">image_path</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1.png</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">caption</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">A bride smiles while the groom points ahead inside a car, their hands resting together on the seat.</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">image_path</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">2.jpg</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">caption</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SALE SALE SALE 50% OFF</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¤ºä¾‹è¾“å‡ºï¼š</p><div class="language-jsonl line-numbers-mode" data-highlighter="shiki" data-ext="jsonl" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-jsonl"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">image_path</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1.png</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">caption</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">A bride smiles while the groom points ahead inside a car, their hands resting together on the seat.</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,20)]))}const p=i(n,[["render",l]]),d=JSON.parse('{"path":"/zh/mm_operators/filter/image_cat_filter/","title":"ImageCatFilter","lang":"zh-CN","frontmatter":{"title":"ImageCatFilter","createTime":"2025/10/15 15:00:00","permalink":"/zh/mm_operators/filter/image_cat_filter/"},"readingTime":{"minutes":3.7,"words":1111},"git":{"createdTime":1764212321000,"updatedTime":1768125121000,"contributors":[{"name":"happykeyan","username":"happykeyan","email":"hankyang428@163.com","commits":2,"avatar":"https://avatars.githubusercontent.com/happykeyan?v=4","url":"https://github.com/happykeyan"}]},"filePathRelative":"zh/notes/mm_operators/image_understanding/filter/image_cat_filter.md","headers":[]}');export{p as comp,d as data};
