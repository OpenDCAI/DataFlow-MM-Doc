import{_ as s,c as a,b as t,o as e}from"./app-Ct5swOin.js";const l={};function n(h,i){return e(),a("div",null,i[0]||(i[0]=[t(`<h2 id="ğŸ“˜-æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#ğŸ“˜-æ¦‚è¿°"><span>ğŸ“˜ æ¦‚è¿°</span></a></h2><p><code>ImageSensitiveFilter</code> åŸºäº <strong>BART Large MNLI</strong> é›¶æ ·æœ¬è‡ªç„¶è¯­è¨€æ¨ç†æ¨¡å‹ï¼Œå¯¹ä¸å›¾åƒç›¸å…³çš„å¤šåˆ—æ–‡æœ¬è¿›è¡Œ<strong>å¤šæ ‡ç­¾å®‰å…¨æ£€æµ‹</strong>ï¼Œè‡ªåŠ¨è¯†åˆ«ä»¥ä¸‹é«˜é£é™©å†…å®¹å¹¶è¿‡æ»¤æ ·æœ¬ï¼š</p><ul><li>æ€§ç›¸å…³å†…å®¹ï¼ˆè‰²æƒ…ã€è£¸ä½“ç­‰ï¼‰</li><li>æš´åŠ›æˆ–ä¼¤å®³</li><li>è‡ªæ€ / è‡ªæ®‹</li><li>ä»‡æ¨è¨€è®º</li><li>éªšæ‰° / ä¾®è¾±</li><li>å¨èƒ / æå“</li></ul><p>ä¸ä¼ ç»Ÿå…³é”®è¯é»‘åå•ä¸åŒï¼Œæœ¬ç®—å­é€šè¿‡â€œæ–‡æœ¬ + é£é™©æè¿°â€çš„ NLI è•´å«å…³ç³»æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ•æ„Ÿå†…å®¹ï¼Œæ›´åŠ <strong>çµæ´»ã€å¯æ‰©å±•</strong>ï¼Œé€‚ç”¨äºå¤šæ¨¡æ€æ•°æ®çš„å®‰å…¨åˆè§„æ¸…æ´—ã€‚</p><h2 id="init-å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#init-å‡½æ•°"><span><code>__init__</code>å‡½æ•°</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> __init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    model_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> str</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">facebook/bart-large-mnli</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    threshold</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> float</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0.5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    device</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> str</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> None</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> None</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">):</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">    ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="initå‚æ•°è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#initå‚æ•°è¯´æ˜"><span><code>init</code>å‚æ•°è¯´æ˜</span></a></h2><table><thead><tr><th style="text-align:left;">å‚æ•°å</th><th style="text-align:left;">ç±»å‹</th><th style="text-align:left;">é»˜è®¤å€¼</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;"><code>model_name</code></td><td style="text-align:left;"><code>str</code></td><td style="text-align:left;"><code>&quot;facebook/bart-large-mnli&quot;</code></td><td style="text-align:left;">NLI æ¨¡å‹æœ¬åœ°è·¯å¾„æˆ– Hugging Face Model IDï¼›å†…éƒ¨é€šè¿‡ <code>AutoTokenizer</code> / <code>AutoModelForSequenceClassification</code> åŠ è½½ï¼ˆ<code>local_files_only=True</code>, <code>use_safetensors=True</code>, <code>weights_only=False</code>ï¼‰ã€‚</td></tr><tr><td style="text-align:left;"><code>threshold</code></td><td style="text-align:left;"><code>float</code></td><td style="text-align:left;"><code>0.5</code></td><td style="text-align:left;">é£é™©ç±»åˆ«çš„<strong>è•´å«æ¦‚ç‡é˜ˆå€¼</strong>ï¼›å½“ä»»ä¸€é£é™©æ ‡ç­¾çš„è•´å«æ¦‚ç‡ <code>â‰¥ threshold</code> æ—¶ï¼Œå³åˆ¤å®šè¯¥æ–‡æœ¬ä¸ºâ€œä¸å®‰å…¨â€ã€‚é˜ˆå€¼è¶Šé«˜ï¼Œè¿‡æ»¤è¶Šä¸¥æ ¼ã€‚</td></tr><tr><td style="text-align:left;"><code>device</code></td><td style="text-align:left;"><code>str | None</code></td><td style="text-align:left;"><code>None</code></td><td style="text-align:left;">æ¨ç†è®¾å¤‡ï¼›<code>None</code> æ—¶è‡ªåŠ¨é€‰æ‹©å¯ç”¨çš„ <code>&quot;cuda&quot;</code>ï¼Œå¦åˆ™ä½¿ç”¨ <code>&quot;cpu&quot;</code>ã€‚</td></tr></tbody></table><h2 id="runå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#runå‡½æ•°"><span><code>run</code>å‡½æ•°</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DataFlowStorage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    input_image_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> str</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    input_text_keys</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> list</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">):</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">    ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œç®—å­ä¸»é€»è¾‘ï¼š</p><ol><li><p>ä» <code>storage</code> è¯»å– DataFrameï¼Œé€è¡Œéå†æ ·æœ¬ï¼›å¯¹æ¯ä¸€è¡Œè¯»å–ï¼š</p><ul><li>å›¾åƒè·¯å¾„ï¼š<code>row[input_image_key]</code></li><li>å¤šä¸ªæ–‡æœ¬å­—æ®µï¼š<code>[row[k] for k in input_text_keys]</code></li></ul></li><li><p><strong>å›¾åƒè·¯å¾„æ£€æŸ¥</strong>ï¼ˆè½»é‡çº§ï¼‰ï¼š</p><ul><li>è‹¥ <code>image_path</code> ä¸ºç©ºæˆ–å¯¹åº”æ–‡ä»¶åœ¨ç£ç›˜ä¸Šä¸å­˜åœ¨ï¼Œç›´æ¥è§†ä¸ºâ€œä¸å®‰å…¨â€ï¼Œè¯¥è¡Œè¢«è¿‡æ»¤å¹¶è®°å½• warning æ—¥å¿—ã€‚</li><li>æœ¬ç‰ˆæœ¬ä¸åšå›¾åƒå†…å®¹è¯†åˆ«ï¼Œä»…åšè·¯å¾„å­˜åœ¨æ€§æ£€æŸ¥ï¼ˆå›¾åƒå†…å®¹å®‰å…¨å»ºè®®ç”±å…¶ä»–ç®—å­å¤„ç†ï¼‰ã€‚</li></ul></li><li><p><strong>æ–‡æœ¬æ•æ„Ÿæ€§æ£€æµ‹ï¼ˆNLI å¤šæ ‡ç­¾é£é™©è¯„åˆ†ï¼‰</strong>ï¼š<br> å¯¹äºå½“å‰è¡Œçš„æ¯ä¸€ä¸ªæ–‡æœ¬å­—æ®µ <code>text</code>ï¼š</p><ol><li>è‹¥æ–‡æœ¬ä¸ºç©ºæˆ–å…¨æ˜¯ç©ºç™½ï¼Œè¿”å›æ‰€æœ‰é£é™©æ ‡ç­¾å¾—åˆ† <code>0.0</code>ã€‚</li><li>å¦åˆ™ï¼Œå¯¹æ¯ä¸ªé£é™©æ ‡ç­¾ <code>label</code>ï¼ˆå¦‚ <code>&quot;violence&quot;</code>, <code>&quot;hate&quot;</code> ç­‰ï¼‰ï¼Œæ„é€ å¯¹åº”çš„<strong>é£é™©æè¿°å¥</strong> <code>desc</code>ï¼Œä¾‹å¦‚ï¼š <ul><li><code>&quot;The text describes physical violence, injury, or killing.&quot;</code></li><li><code>&quot;The text attacks or insults a group based on race, religion, gender or similar traits.&quot;</code></li></ul></li><li>è°ƒç”¨ <code>AutoTokenizer</code> å¯¹ <code>(premise=text, hypothesis=desc)</code> ç¼–ç ï¼Œå¹¶é€å…¥ MNLI æ¨¡å‹ï¼š <ul><li>å–è¾“å‡º logits å¯¹åº”çš„ <code>entailment</code> æ¦‚ç‡ï¼ˆç´¢å¼• 2ï¼‰ä½œä¸ºè¯¥ label çš„é£é™©åˆ†æ•° <code>score[label]</code>ã€‚</li></ul></li><li>æ±‡æ€»å¾—åˆ°å½“å‰æ–‡æœ¬çš„é£é™©å¾—åˆ†å­—å…¸ï¼š<code>{label_name: entail_prob}</code>ã€‚</li></ol></li><li><p><strong>æ ·æœ¬çº§å®‰å…¨åˆ¤å®š</strong>ï¼š</p><ul><li>å¯¹ä¸€è¡Œä¸­æ‰€æœ‰æ–‡æœ¬å­—æ®µå’Œæ‰€æœ‰é£é™©æ ‡ç­¾çš„åˆ†æ•°å–æœ€å¤§å€¼ï¼š<code>max_risk = max(all_scores)</code>ã€‚</li><li>è‹¥ <code>max_risk â‰¥ threshold</code>ï¼Œåˆ™åˆ¤å®šè¯¥æ ·æœ¬åœ¨æŸä¸€é£é™©ç±»åˆ«ä¸Šé«˜åº¦æ•æ„Ÿï¼š <ul><li>æ ‡è®°ä¸ºâ€œä¸å®‰å…¨â€ï¼Œè¯¥è¡Œè¢«è¿‡æ»¤ï¼Œå¹¶åœ¨è°ƒè¯•æ—¥å¿—ä¸­æ‰“å°ï¼šè¡Œå·ã€å›¾åƒè·¯å¾„ä»¥åŠæˆªæ–­åçš„æ–‡æœ¬å†…å®¹ã€‚</li></ul></li><li>è‹¥ <code>max_risk &lt; threshold</code>ï¼Œåˆ™è¯¥å›¾æ–‡æ ·æœ¬åˆ¤å®šä¸ºâ€œå®‰å…¨â€ï¼Œäºˆä»¥ä¿ç•™ã€‚</li></ul></li><li><p>å°†æ‰€æœ‰â€œå®‰å…¨â€æ ·æœ¬å¯¹åº”çš„å¸ƒå°”æ©ç  <code>refined_mask</code> åº”ç”¨äºåŸ DataFrameï¼Œå¾—åˆ°è¿‡æ»¤åçš„æ–° DataFrameï¼š</p><ul><li>è°ƒç”¨ <code>reset_index(drop=True)</code> é‡æ’ç´¢å¼•ã€‚</li><li>ä½¿ç”¨ <code>storage.write(filtered_df)</code> å°†ç»“æœå†™å›ã€‚</li></ul></li><li><p>è¿”å›åˆ—ååˆ—è¡¨ï¼š</p><ul><li>è¿”å› <code>[input_image_key] + input_text_keys</code>ï¼Œç”¨äºä¸‹æ¸¸ç®—å­ä½œä¸ºè¾“å…¥åˆ—åçº¦å®šã€‚</li></ul></li></ol><p>å‚æ•°</p><table><thead><tr><th style="text-align:left;">å‚æ•°å</th><th style="text-align:left;">ç±»å‹</th><th style="text-align:left;">é»˜è®¤å€¼</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;"><code>storage</code></td><td style="text-align:left;"><code>DataFlowStorage</code></td><td style="text-align:left;">æ— </td><td style="text-align:left;">Dataflow çš„è¯»å†™å­˜å‚¨å¯¹è±¡ã€‚</td></tr><tr><td style="text-align:left;"><code>input_image_key</code></td><td style="text-align:left;"><code>str</code></td><td style="text-align:left;">æ— </td><td style="text-align:left;">å›¾åƒè·¯å¾„æ‰€åœ¨åˆ—çš„åˆ—åï¼ˆå¦‚ <code>&quot;image&quot;</code>ï¼‰ã€‚ä»…ç”¨äºæ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œä¸åšå›¾åƒå†…å®¹æ¨ç†ã€‚</td></tr><tr><td style="text-align:left;"><code>input_text_keys</code></td><td style="text-align:left;"><code>list[str]</code></td><td style="text-align:left;">æ— </td><td style="text-align:left;">éœ€è¦è¿›è¡Œæ•æ„Ÿæ€§æ£€æµ‹çš„æ–‡æœ¬åˆ—ååˆ—è¡¨ï¼ˆå¦‚ <code>[&quot;caption&quot;, &quot;question&quot;, &quot;answer&quot;]</code>ï¼‰ã€‚ç®—å­ä¼šå¯¹åˆ—è¡¨ä¸­çš„æ¯ä¸€åˆ—æ–‡æœ¬é€æ¡è¿›è¡Œé£é™©è¯„ä¼°ã€‚</td></tr></tbody></table><h2 id="ğŸ§ -ç¤ºä¾‹ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#ğŸ§ -ç¤ºä¾‹ç”¨æ³•"><span>ğŸ§  ç¤ºä¾‹ç”¨æ³•</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">utils</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> FileStorage</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">operators</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">core_vision </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ImageSensitiveFilter</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 1) å‡†å¤‡ FileStorageï¼ˆè‡³å°‘åŒ…å« imageã€caption ç­‰åˆ—ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> FileStorage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    first_entry_file_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">./dataflow/example/test_image_filter/test_image_filter.jsonl</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    cache_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">./cache_local</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    file_name_prefix</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">imgtext_sensitive_filter</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    cache_type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">jsonl</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 2) åˆå§‹åŒ–ç®—å­ï¼ˆå¯ä½¿ç”¨æœ¬åœ°æˆ– HF æ¨¡å‹IDï¼‰</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">filt </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ImageSensitiveFilter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    model_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">facebook/bart-large-mnli</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # æˆ–æœ¬åœ° ckpt è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    threshold</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0.5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">                          # é£é™©åˆ¤å®šé˜ˆå€¼</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    device</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">None</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">                             # è‡ªåŠ¨é€‰æ‹© cuda/cpu</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 3) æ‰§è¡Œè¿‡æ»¤ï¼šå¯¹ image + å¤šåˆ—æ–‡æœ¬åšæ•æ„Ÿå†…å®¹æ£€æµ‹</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cols </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> filt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_image_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">image</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_text_keys</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=[</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">caption</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">question</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">answer</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cols</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # [&quot;image&quot;, &quot;caption&quot;, &quot;question&quot;, &quot;answer&quot;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ğŸ§¾-é»˜è®¤è¾“å‡ºæ ¼å¼-output-format" tabindex="-1"><a class="header-anchor" href="#ğŸ§¾-é»˜è®¤è¾“å‡ºæ ¼å¼-output-format"><span>ğŸ§¾ é»˜è®¤è¾“å‡ºæ ¼å¼ï¼ˆOutput Formatï¼‰</span></a></h3><table><thead><tr><th style="text-align:left;">å­—æ®µ</th><th style="text-align:left;">ç±»å‹</th><th style="text-align:left;">é»˜è®¤å€¼</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;"><code>input_image_key</code> å¯¹åº”åˆ—</td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;">æ— </td><td style="text-align:left;">åŸå§‹å›¾åƒè·¯å¾„åˆ—ï¼Œè¿‡æ»¤åä»…ä¿ç•™é€šè¿‡å®‰å…¨æ£€æµ‹çš„æ ·æœ¬è¡Œã€‚</td></tr><tr><td style="text-align:left;"><code>input_text_keys</code> å¯¹åº”å„åˆ—</td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;">æ— </td><td style="text-align:left;">åŸå§‹æ–‡æœ¬åˆ—ï¼ˆcaption / question / answer ç­‰ï¼‰ï¼Œè¿‡æ»¤åä»…ä¿ç•™æ–‡æœ¬å‡é€šè¿‡å®‰å…¨æ£€æµ‹çš„æ ·æœ¬è¡Œã€‚</td></tr></tbody></table><p>ç¤ºä¾‹è¾“å…¥ï¼š</p><div class="language-jsonl line-numbers-mode" data-highlighter="shiki" data-ext="jsonl" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-jsonl"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">image_path</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1.png</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">text</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">A bride and groom smiling in a car.</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">image_path</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">2.jpg</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">text</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Some abusive or hateful phrase here.</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¤ºä¾‹è¾“å‡ºï¼š</p><div class="language-jsonl line-numbers-mode" data-highlighter="shiki" data-ext="jsonl" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-jsonl"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">image_path</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">1.png</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">text</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">A bride and groom smiling in a car.</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,22)]))}const d=s(l,[["render",n]]),p=JSON.parse('{"path":"/zh/mm_operators/filter/image_sensitive_filter/","title":"ImageSensitiveFilter","lang":"zh-CN","frontmatter":{"title":"ImageSensitiveFilter","createTime":"2025/10/15 15:31:35","permalink":"/zh/mm_operators/filter/image_sensitive_filter/"},"readingTime":{"minutes":3.73,"words":1119},"git":{"createdTime":1764212321000,"updatedTime":1768125121000,"contributors":[{"name":"happykeyan","username":"happykeyan","email":"hankyang428@163.com","commits":2,"avatar":"https://avatars.githubusercontent.com/happykeyan?v=4","url":"https://github.com/happykeyan"}]},"filePathRelative":"zh/notes/mm_operators/image_understanding/filter/image_sensitive_filter.md","headers":[]}');export{d as comp,p as data};
